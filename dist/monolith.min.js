!function(){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}angular.module("monstrousFilterererAppModule",["hotelsModule"]),angular.module("monstrousFilterererAppModule").config(["$interpolateProvider","$compileProvider",function($interpolateProvider,$compileProvider){$interpolateProvider.startSymbol("[["),$interpolateProvider.endSymbol("]]"),$compileProvider.debugInfoEnabled(!1),$compileProvider.commentDirectivesEnabled(!1),$compileProvider.cssClassDirectivesEnabled(!1)}]),angular.module("filtersModule",["observableModule"]);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),FiltersCostController=function(){function FiltersCostController($window,$scope,filtersInterface){var _this=this;_classCallCheck(this,FiltersCostController),this._$window=$window,this._filtersInterface=filtersInterface,this.limitMin=0,this.limitMax=1e4,this._setLimitsFromBackendData(),this.valueMin=this.limitMin,this.valueMax=this.limitMax,this._dispatchValue(),this.dispatchValueDebounced=_.debounce(function(){$scope.$apply(_this._dispatchValue.bind(_this))},FiltersCostController.debounceTime)}return _createClass(FiltersCostController,null,[{key:"initClass",value:function initClass(){FiltersCostController.debounceTime=500,FiltersCostController.$inject=["$window","$scope","filtersInterface"]}}]),_createClass(FiltersCostController,[{key:"_dispatchValue",value:function _dispatchValue(){this._filtersInterface.setCostRange(this.valueMin,this.valueMax)}},{key:"_setLimitsFromBackendData",value:function _setLimitsFromBackendData(){if("object"===_typeof(this._$window.hotelsData)){var lowestCost=1/0,highestCost=0;this._$window.hotelsData.Establishments.forEach(function(hotel){hotel.MinCost<lowestCost?lowestCost=Math.floor(hotel.MinCost):hotel.MinCost>highestCost&&(highestCost=Math.ceil(hotel.MinCost))}),this.limitMin=lowestCost,this.limitMax=highestCost}}}]),FiltersCostController}();FiltersCostController.initClass(),angular.module("filtersModule").controller("filtersCostCtrl",FiltersCostController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),FiltersHotelNameController=function(){function FiltersHotelNameController(filtersInterface){_classCallCheck(this,FiltersHotelNameController),this._filtersInterface=filtersInterface,this.value="",this.dispatchValue()}return _createClass(FiltersHotelNameController,null,[{key:"initClass",value:function initClass(){FiltersHotelNameController.$inject=["filtersInterface"]}}]),_createClass(FiltersHotelNameController,[{key:"dispatchValue",value:function dispatchValue(){this._filtersInterface.setHotelName(this.value)}}]),FiltersHotelNameController}();FiltersHotelNameController.initClass(),angular.module("filtersModule").controller("filtersHotelNameCtrl",FiltersHotelNameController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),FiltersInterfaceService=function(){function FiltersInterfaceService(){_classCallCheck(this,FiltersInterfaceService),this._hotelName=null,this._minStars=null,this._costMin=null,this._costMax=null,this._minRating=null}return _createClass(FiltersInterfaceService,[{key:"setHotelName",value:function setHotelName(hotelName){this._hotelName=hotelName.toLowerCase()}},{key:"setMinimumStars",value:function setMinimumStars(stars){this._minStars=Number.parseInt(stars,10)}},{key:"setCostRange",value:function setCostRange(minimum,maximum){this._costMin=Number.parseInt(minimum,10),this._costMax=Number.parseInt(maximum,10)}},{key:"setMinimumRating",value:function setMinimumRating(rating){this._minRating=Number.parseFloat(rating)}},{key:"matchHotel",value:function matchHotel(hotel){if(!_.isEmpty(this._hotelName)&&!hotel.Name.toLowerCase().includes(this._hotelName))return!1;if(_.isInteger(this._minStars)&&Number.parseInt(hotel.Stars,10)<this._minStars)return!1;if(_.isInteger(this._costMin)&&_.isInteger(this._costMax)){var costNumber=Number.parseFloat(hotel.MinCost);if(costNumber>this._costMax||costNumber<this._costMin)return!1}return!(_.isNumber(this._minRating)&&Number.parseFloat(hotel.UserRating)<this._minRating)}}]),FiltersInterfaceService}();angular.module("filtersModule").service("filtersInterface",FiltersInterfaceService);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),FiltersRatingController=function(){function FiltersRatingController($scope,filtersInterface){var _this=this;_classCallCheck(this,FiltersRatingController),this._filtersInterface=filtersInterface,this.limitMin=0,this.limitMax=10,this.value=this.limitMin,this._dispatchValue(),this.dispatchValueDebounced=_.debounce(function(){$scope.$apply(_this._dispatchValue.bind(_this))},FiltersRatingController.debounceTime)}return _createClass(FiltersRatingController,null,[{key:"initClass",value:function initClass(){FiltersRatingController.debounceTime=500,FiltersRatingController.$inject=["$scope","filtersInterface"]}}]),_createClass(FiltersRatingController,[{key:"_dispatchValue",value:function _dispatchValue(){this._filtersInterface.setMinimumRating(this.value)}}]),FiltersRatingController}();FiltersRatingController.initClass(),angular.module("filtersModule").controller("filtersRatingCtrl",FiltersRatingController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),FiltersStarsController=function(){function FiltersStarsController(filtersStarsOptions,filtersInterface){_classCallCheck(this,FiltersStarsController),this._filtersInterface=filtersInterface,this.selectedOption=filtersStarsOptions.options[0],this.options=filtersStarsOptions.options,this.dispatchValue()}return _createClass(FiltersStarsController,null,[{key:"initClass",value:function initClass(){FiltersStarsController.$inject=["filtersStarsOptions","filtersInterface"]}}]),_createClass(FiltersStarsController,[{key:"dispatchValue",value:function dispatchValue(){this._filtersInterface.setMinimumStars(this.selectedOption.count)}}]),FiltersStarsController}();FiltersStarsController.initClass(),angular.module("filtersModule").controller("filtersStarsCtrl",FiltersStarsController),angular.module("filtersModule").constant("filtersStarsOptions",{options:[{label:"Any",count:0},{label:"★".repeat(1),count:1},{label:"★".repeat(2),count:2},{label:"★".repeat(3),count:3},{label:"★".repeat(4),count:4},{label:"★".repeat(5),count:5}]}),angular.module("hotelsModule",["filtersModule","sorterModule"]);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),HotelsController=function(){function HotelsController($window,sorterInterface,filtersInterface){_classCallCheck(this,HotelsController),this._$window=$window,this._sorterInterface=sorterInterface,this.list=this._getListFromBackendData(),this.currentSort=null,this._refreshSort(),this._sorterInterface.registerSortObserver(this._refreshSort.bind(this)),this.matchHotel=filtersInterface.matchHotel.bind(filtersInterface)}return _createClass(HotelsController,null,[{key:"initClass",value:function initClass(){HotelsController.$inject=["$window","sorterInterface","filtersInterface"]}}]),_createClass(HotelsController,[{key:"chooseHotel",value:function chooseHotel(hotel){this._$window.alert("You've chosen "+hotel.Name+". An excellent choice, may I say.")}},{key:"_getListFromBackendData",value:function _getListFromBackendData(){return"object"===_typeof(this._$window.hotelsData)?this._$window.hotelsData.Establishments:[]}},{key:"_refreshSort",value:function _refreshSort(){this.currentSort=this._sorterInterface.getSort()}}]),HotelsController}();HotelsController.initClass(),angular.module("hotelsModule").controller("hotelsCtrl",HotelsController),angular.module("hotelsModule").filter("humanizeDistance",function(){return function(kilometers){if(kilometers<1){return 1e3*kilometers.toFixed(3)+" m"}if(kilometers>=1&&kilometers<10){return kilometers.toFixed(2)+" km"}return kilometers.toFixed(0)+" km"}}),angular.module("hotelsModule").filter("humanizeStars",function(){return function(numberOfStars){return"★".repeat(numberOfStars)+"☆".repeat(5-numberOfStars)}}),angular.module("hotelsModule").filter("humanizeVotesCount",function(){return function(votes){return 1===votes?votes+" vote":votes+" votes"}}),angular.module("observableModule",[]);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),ObservableModel=function(){function ObservableModel(){_classCallCheck(this,ObservableModel),this._observers=[],this._amountOfObservers=0,this._observersToRemove=[],this._amountToRemove=0,this._stateObservers=[],this._isActive=!1}return _createClass(ObservableModel,[{key:"_createCancelFunction",value:function _createCancelFunction(observerToCancel,afterCancelCallback){return function(){afterCancelCallback(observerToCancel),observerToCancel=null,afterCancelCallback=null}}},{key:"_afterCancel",value:function _afterCancel(observerToRemove){this._amountToRemove=this._observersToRemove.push(observerToRemove)}},{key:"_cleanRemovedObservers",value:function _cleanRemovedObservers(){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this._observersToRemove[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var observerToRemove=_step.value,indexOf=this._observers.indexOf(observerToRemove);indexOf!==-1&&this._observers.splice(indexOf,1)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}this._amountOfObservers=this._observers.length,this._amountToRemove=0,this._observersToRemove.length=0,this._updateState(this._amountOfObservers>0)}},{key:"_updateState",value:function _updateState(newActiveState){if(this._isActive!==newActiveState){this._isActive=newActiveState;var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=this._stateObservers[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){(0,_step2.value)(this._isActive)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}}},{key:"register",value:function register(newObserver){return this._amountOfObservers=this._observers.push(newObserver),this._updateState(!0),this._createCancelFunction(newObserver,this._afterCancel.bind(this))}},{key:"notify",value:function notify(){if(0!==this._amountToRemove&&this._cleanRemovedObservers(),this._isActive){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];if(1===this._amountOfObservers)return void this._observers[0].apply(null,args);var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=this._observers[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){_step3.value.apply(null,args)}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}}}},{key:"onStateChange",value:function onStateChange(stateObserver){return this._stateObservers.push(stateObserver)}}]),ObservableModel}();angular.module("observableModule").factory("Observable",function(){return ObservableModel}),angular.module("sorterModule",["observableModule"]);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),SorterController=function(){function SorterController(sorterOptions,sorterInterface){_classCallCheck(this,SorterController),this._sorterInterface=sorterInterface,this.selectedOption=sorterOptions.options[0],this.options=sorterOptions.options,this.dispatchValue()}return _createClass(SorterController,null,[{key:"initClass",value:function initClass(){SorterController.$inject=["sorterOptions","sorterInterface"]}}]),_createClass(SorterController,[{key:"dispatchValue",value:function dispatchValue(){this._sorterInterface.setSort(this.selectedOption)}}]),SorterController}();SorterController.initClass(),angular.module("sorterModule").controller("sorterCtrl",SorterController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),SorterInterfaceService=function(){function SorterInterfaceService(Observable){_classCallCheck(this,SorterInterfaceService),this._currentSort=null,this._sortObservable=new Observable}return _createClass(SorterInterfaceService,null,[{key:"initClass",value:function initClass(){SorterInterfaceService.$inject=["Observable"]}}]),_createClass(SorterInterfaceService,[{key:"registerSortObserver",value:function registerSortObserver(observer){return this._sortObservable.register(observer)}},{key:"setSort",value:function setSort(sortOption){this._currentSort=sortOption,this._sortObservable.notify()}},{key:"getSort",value:function getSort(){return this._currentSort}}]),SorterInterfaceService}();SorterInterfaceService.initClass(),angular.module("sorterModule").service("sorterInterface",SorterInterfaceService),angular.module("sorterModule").constant("sorterOptions",{options:[{label:"Distance: nearest first",property:"Distance",propertyReverse:!1},{label:"Distance: furthest first",property:"Distance",propertyReverse:!0},{label:"Stars: best first",property:"Stars",propertyReverse:!0},{label:"Stars: worst first",property:"Stars",propertyReverse:!1},{label:"Cost: cheapest first",property:"MinCost",propertyReverse:!1},{label:"Cost: most expensive first",property:"MinCost",propertyReverse:!0},{label:"Rating: lowest first",property:"UserRating",propertyReverse:!1},{label:"Rating: highest first",property:"UserRating",propertyReverse:!0}]})}();